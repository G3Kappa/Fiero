:- module(bomb, []).
:- subscribe(action, [actor_turn_started]).

began :- 
	set_counter(fuse, 3).
ended :-
	effect(effect_def(explosion, 2), @owner, _).

tick :-
	counter(fuse, T),
	position(@owner, P),
	animate(true, P, [damage_number{damage: T, tint: light_red}]).

tock :-
	update_counter(fuse, decrement, T), 
	(T <= 0) -> end.

% schedule animation on player turn start to prevent visual glitches
action:actor_turn_started(_{actor:@player}) :- tick, tock.
